<div class="card">
  <div class="card-body">
    <h5 class="card-title">Upload video for attendance</h5>

    <% if (typeof error !== "undefined" && error) { %>
      <div class="alert alert-danger"><%= error %></div>
    <% } %>

    <% if (allDone) { %>
      <div class="alert alert-success">✅ All lectures for today are done.</div>
      <a href="/analysis/today" class="btn btn-info">View Today's Analysis</a>
    <% } else { %>
      <% if (subjectsToday && subjectsToday.length > 0) { %>
        <form action="/upload" method="POST" enctype="multipart/form-data">
          <div class="mb-3">
            <label class="form-label">Select Lecture (today)</label>
            <select class="form-select" name="lectureNumber" required>
              <% subjectsToday.forEach((subj, idx) => { %>
                <option value="<%= idx+1 %>">Lecture <%= idx+1 %> — <%= subj %></option>
              <% }) %>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Video file</label>
            <input class="form-control" type="file" name="video" accept="video/*" required />
          </div>

          <div class="row">
            <div class="col-md-4">
              <label class="form-label">Frames/sec</label>
              <input class="form-control" type="number" name="sample_fps" min="0.1" step="0.1" value="1.0" />
            </div>
            <div class="col-md-4">
              <label class="form-label">Min frames</label>
              <input class="form-control" type="number" name="min_frames" min="1" step="1" value="1" />
            </div>
          </div>

          <div class="mt-3">
            <button class="btn btn-primary" type="submit">Upload & Process</button>
          </div>
        </form>
      <% } else { %>
        <div class="alert alert-warning">No timetable found for today.</div>
      <% } %>
    <% } %>
  </div>
</div>